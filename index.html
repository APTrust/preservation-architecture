



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>APTrust Preservation Services Architecture</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#aptrust-preservation-services-architecture" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="APTrust Preservation Services Architecture" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              APTrust Preservation Services Architecture
            </span>
            <span class="md-header-nav__topic">
              
                Home
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/APTrust/services-architecture/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="." title="APTrust Preservation Services Architecture" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    APTrust Preservation Services Architecture
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/APTrust/services-architecture/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Home
      </label>
    
    <a href="." title="Home" class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#services-provided" title="Services Provided" class="md-nav__link">
    Services Provided
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Ingest
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Ingest
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/bucket_reader/" title="Bucket Reader" class="md-nav__link">
      Bucket Reader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/pre_fetch/" title="Pre-Fetch" class="md-nav__link">
      Pre-Fetch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/validation/" title="Validation" class="md-nav__link">
      Validation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/reingest_check/" title="Reingest Check" class="md-nav__link">
      Reingest Check
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/staging/" title="Copy to Staging" class="md-nav__link">
      Copy to Staging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/format_identification/" title="Format Identification" class="md-nav__link">
      Format Identification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/storage/" title="Copy to Preservation" class="md-nav__link">
      Copy to Preservation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/storage_validation/" title="Storage Validation" class="md-nav__link">
      Storage Validation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/metadata_recording/" title="Metadata Recording" class="md-nav__link">
      Metadata Recording
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/ingest/cleanup/" title="Cleanup" class="md-nav__link">
      Cleanup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/fixity/" title="Fixity Checking" class="md-nav__link">
      Fixity Checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/deletion/" title="Deletion" class="md-nav__link">
      Deletion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="services/restoration/" title="Restoration" class="md-nav__link">
      Restoration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Scaling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Scaling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="scaling/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Components
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Components
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="components/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="components/receiving/" title="Receiving" class="md-nav__link">
      Receiving
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="components/restoration/" title="Restoration" class="md-nav__link">
      Restoration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="components/preservation/" title="Preservation" class="md-nav__link">
      Preservation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="components/pharos/" title="Pharos" class="md-nav__link">
      Pharos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="components/rds/" title="Postgres RDS Database" class="md-nav__link">
      Postgres RDS Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="components/microservices/" title="Microservices" class="md-nav__link">
      Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="components/nsq/" title="NSQ" class="md-nav__link">
      NSQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="components/redis/" title="Redis" class="md-nav__link">
      Redis
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#services-provided" title="Services Provided" class="md-nav__link">
    Services Provided
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/APTrust/services-architecture/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="aptrust-preservation-services-architecture">APTrust Preservation Services Architecture</h1>
<p>This site describes the architectural components and general workflow of APTrust's third-generation preservation services. As of August, 2020, APTrust's production and demo repositories are running on our second-generation services suite, code-named Exchange.</p>
<p>The services described in these documents are currently being tested in our staging environment. In replacing our existing, stable, and heavily patched second-generation services, the goals of the new service suite include:</p>
<ul>
<li>Modularize code to separate concerns</li>
<li>Improve code clarity and maintainability</li>
<li>Improve test coverage</li>
<li>Improve horizontal scalability by storing interim processing information in network accessible services instead of on local disk</li>
<li>Support BagIt profiles other than APTrust</li>
<li>Support S3-compliant storage providers other than AWS</li>
<li>Eliminate reliance on expensive and problematic EBS volumes</li>
</ul>
<p>The new preservation architecture also supports the primary goals of the prior architecture, which include:</p>
<ul>
<li><strong>Resilience</strong> - The system must be able to recover from failures and resume whatever processing was occuring at the time of failure without any loss of information.</li>
<li><strong>Reliability</strong> - The system must process all valid requests for ingest, deletion, fixity checking, restoration to completion.</li>
<li><strong>Accountability</strong> - The system must maintain a record of all actions performed on all objects and files. It must also record the existence and outcome of all tasks that were requested but could not be completed.</li>
<li><strong>Security</strong> - All files in preservation storage must be unreachable except through the administrative interface of Pharos. Destructive actions, such as deletions, require multiple approvals from depositors.</li>
<li><strong>Transparency</strong> - Depositors must be able to see the present state of any item, ingested or not, that is within the normal flow of processing. Administrators must be able to see all that and information about abnormal or failed states.</li>
<li><strong>Service Provider Agnosticism</strong> - APTrust services must, whenever possible, avoid relying on vendor-specific technologies. The entire system should be portable to any cloud provider or to any data center that runs Linux servers. Preservation services adhere to this principle by being open source, written in a cross-platform language (Go), and relying only on open source services such as Redis and NSQ, and standardized or de facto protocols and APIs such as HTTPS and S3.</li>
</ul>
<p>Performance takes last place in our priority list. In general, it doesn't matter to a depositor whether it takes ten minutes or ten hours for us to ingest materials. However, APTrust receives periodic ingest floods which our second-generation architecture could take weeks to clear and which required regular human intervention.</p>
<p>The horizontal scaling capabilities of the new architecture should allow us to process weeks-long backlogs in a matter of days, with little or no human intervention.</p>
<h2 id="services-provided">Services Provided</h2>
<p>APTrust provides the following preservation services:</p>
<ul>
<li>Ingest</li>
<li>Ongoing Fixity Checks</li>
<li>Deletion</li>
<li>Restoration</li>
</ul>
<p>Each service is composed of the following:</p>
<ul>
<li><strong>Temporary Storage</strong> includes S3 buckets in Amazon Web Services (AWS) to which depositors can upload items for ingest (receiving buckets), from which depositors can download restored objects and files (restoration buckets), and in which APTrust ingest processes store temporary data (staging buckets).</li>
<li><strong>Preservation Storage</strong> consists of Glacier and S3 buckets provided by AWS and other commercial cloud providers. Depositors have no access to these buckets, and even APTrust staff have limited access.</li>
<li><strong>Pharos</strong>, a Rails application backed by a Postgres database, which tracks information about all objects and files preserved in (and deleted from) preservation storage. Pharos also allows authorized users to requestion deletion and restoration of objects and files.</li>
<li><strong>Microservices</strong> running on Amazon EC2 instances perform the work required for ingest, fixity checking, deletion and restoration.</li>
<li><strong>Supporting Services</strong> help microservices orchestrate multistep processes. These include NSQ, for managing work queues, and Redis for tracking internal state and metadata across processes in which multiple microservices must coordinate work.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="services/ingest/" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Overview
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>